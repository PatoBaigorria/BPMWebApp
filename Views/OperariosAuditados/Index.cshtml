@model List<BPMWebApp.Models.OperarioAuditoriaResumenDTO>

@{
    ViewBag.Title = "Operarios Auditados";
}

<h2>Operarios Auditados</h2>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">@ViewBag.Error</div>
}

<div class="d-flex justify-content-between mb-3">
    <form method="get" class="flex-grow-1 me-2">
        <div class="row">
            <div class="col-md-3">
                <label>Desde</label>
                <input type="date" name="desde" class="form-control" value="@ViewBag.Desde" />
            </div>
            <div class="col-md-3">
                <label>Hasta</label>
                <input type="date" name="hasta" class="form-control" value="@ViewBag.Hasta" />
            </div>
            <div class="col-md-3">
                <label>Legajo Operario</label>
                <input type="number" name="legajo" class="form-control" value="@ViewBag.Legajo" />
            </div>
            <div class="col-md-3 align-self-end">
                <button type="submit" class="btn btn-primary">Filtrar</button>
            </div>
        </div>
    </form>
    
    <!-- Botón de exportación a Excel -->
    <div class="align-self-end">
        <a href="@Url.Action("ExportarExcel", "OperariosAuditados", new { desde = ViewBag.Desde, hasta = ViewBag.Hasta, legajo = ViewBag.Legajo })" class="btn btn-success">
            <i class="fas fa-file-excel me-1"></i> Exportar a Excel
        </a>
    </div>
</div>

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Legajo</th>
            <th>Nombre</th>
            <th>Auditorías Positivas</th>
            <th>Auditorías Negativas</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
    @if (Model != null && Model.Any())
    {
        foreach (var op in Model)
        {
            <tr>
                <td>@op.Legajo</td>
                <td>@op.Nombre</td>
                <td><span class="badge bg-success">@op.AuditoriasPositivas</span></td>
                <td><span class="badge bg-danger">@op.AuditoriasNegativas</span></td>
                <td>
                    @if (op.AuditoriasNegativas > 0)
                    {
                        <a href="@Url.Action("Detalle", "OperariosAuditados", new { legajo = op.Legajo })" class="btn btn-warning btn-sm">Detalles</a>
                    }
                </td>
            </tr>
        }
    }
    else
    {
        <tr>
            <td colspan="5" class="text-center">No se encontraron resultados.</td>
        </tr>
    }
    </tbody>
</table>
